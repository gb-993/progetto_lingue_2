{% extends "base.html" %} 
{% block title %}Dashboard{% endblock %}
{% block breadcrumb %}Dashboard{% endblock %}

{% block content %}


  <div class="grid grid-3" role="navigation" aria-label="Dashboard shortcuts">

    {# ---- visibili a tutti ---- #}
    <a class="card btn" href="{% url 'language_list' %}" aria-label="Apri la lista delle lingue">
      <h3>Languages</h3>
      <p class="muted">Gestisci/visualizza lingue e dati</p>
    </a>

    <a class="card btn" href="{% url 'glossary_list' %}" aria-label="Apri il glossario">
      <h3>Glossary</h3>
      <p class="muted">Termini e definizioni</p>
    </a>

    <a class="card btn" href="{% url 'my_account' %}" aria-label="Modifica il tuo account">
      <h3>My Account</h3>
      <p class="muted">Modifica i tuoi dati</p>
    </a>

    {# ---- solo admin/staff ---- #}
    {% if is_admin %}
      <a class="card btn" href="{% url 'parameter_list' %}" aria-label="Apri la gestione dei parametri">
        <h3>Parameters</h3>
        <p class="muted">Definizioni e domande</p>
      </a>

      <a class="card btn" href="{% url 'tablea_index' %}" aria-label="Apri Tabella A riepilogo parametri per lingua">
        <h3>Table A</h3>
        <p class="muted">Riepilogo parametri × lingue</p>
      </a>

      <a class="card btn" href="{% url 'accounts_list' %}" aria-label="Apri la gestione degli account">
        <h3>Accounts</h3>
        <p class="muted">Admin &amp; Users</p>
      </a>

      <a class="card btn" href="{% url 'queries:home' %}" aria-label="Apri interrogazioni (faceted search)">
        <h3>Queries</h3>
        <p class="muted">Interrogazioni al database</p>
      </a>

      <a class="card btn" href="{% url 'submissions_list' %}" aria-label="Apri la lista delle submissions">
        <h3>Submissions</h3>
        <p class="muted">Gestisci/visualizza submissions</p>
      </a>
    {% endif %}
  </div>


  {% if is_admin %}
  <section class="card mt-3" aria-labelledby="last-changes-heading">
    <h3 id="last-changes-heading">Ultime modifiche</h3>

    {% if recent_param_changes %}
      <ul class="list">
        {% for log in recent_param_changes %}
          <li>
            <div>
              <strong>{{ log.parameter_id }}</strong>
              <span class="muted">— {{ log.changed_at|date:"Y-m-d H:i" }}</span>
            </div>
            <div class="muted">
              di {{ log.changed_by.email|default:"(utente sconosciuto)" }}
            </div>

            <details class="mt-1">
              <summary>Recap</summary>
              <p>{{ log.recap }}</p>
            </details>

            {% if log.diff %}
              <details class="mt-1">
                <summary>Dettaglio campi modificati</summary>
                <ul class="list">
                  {% for field, vals in log.diff.items %}
                    <li>
                      <code>{{ field }}</code>:
                      <em>old</em> = "{{ vals.old }}",
                      <em>new</em> = "{{ vals.new }}"
                    </li>
                  {% endfor %}
                </ul>
              </details>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="muted">Nessuna modifica recente ai parametri.</p>
    {% endif %}
  </section>
  {% endif %}

{% endblock %}
