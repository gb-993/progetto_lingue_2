{% extends "base.html" %}

{% block title %}Import language data from Excel{% endblock %}
{% block breadcrumb %}Languages / Import from Excel{% endblock %}

{% block content %}
  <div class="card">
    {% if import_done %}
      {# === STATO DOPO IMPORT COMPLETATO === #}
      <h2 class="h3">Import completed</h2>

      <p class="muted">
        {% if uploaded_filename %}
          The file <code>{{ uploaded_filename }}</code> has been imported successfully.
        {% else %}
          The language data has been imported successfully.
        {% endif %}
      </p>

      <div class="toolbar" style="display:flex; justify-content:flex-end; gap:.5rem; margin-top:1rem;">
        <a class="btn btn--primary" href="{% url 'language_list' %}">
          Back to languages list
        </a>
      </div>

    {% else %}
      {# === STATO NORMALE: FORM DI UPLOAD === #}
      <h2 class="h3">Import language data from Excel</h2>

      <p class="muted">
        Select an Excel file (.xlsx) containing language data.  
        The import will use the same rules as the existing <code>import_language_from_excel</code> command.
      </p>

      <p id="import-status"
         class="muted"
         aria-live="polite"
         style="margin-bottom:1rem;">
        After you click <strong>Import</strong>, the file will be uploaded and processed.
        Please do not close or reload this page until the operation is complete.
      </p>

      <form id="excel-import-form"
            method="post"
            enctype="multipart/form-data"
            novalidate>
        {% csrf_token %}

        <div class="form-row">
          <label for="id_file">Excel file</label>
          <input type="file"
                 id="id_file"
                 name="file"
                 accept=".xlsx,.xlsm,.xltx,.xltm"
                 class="form-control"
                 required>
        </div>

        <div class="toolbar" style="display:flex; justify-content:flex-end; gap:.5rem; margin-top:1rem;">
          <a class="btn" href="{% url 'language_list' %}">Cancel</a>
          <button type="submit" class="btn btn--primary">
            Import
          </button>
        </div>
      </form>
    {% endif %}
  </div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function () {
  var form = document.getElementById('excel-import-form');
  if (!form) return;

  var fileInput = document.getElementById('id_file');
  var submitBtn = form.querySelector('button[type="submit"]');
  var statusEl = document.getElementById('import-status');

  form.addEventListener('submit', function () {
    // se non c'è file, lascia passare il validatore HTML5 (required sull'input)
    if (fileInput && !fileInput.value) {
      return;
    }



    if (submitBtn) {
      submitBtn.disabled = true;
      submitBtn.textContent = 'Import in progress…';
    }
    if (statusEl) {
      statusEl.textContent = 'File uploaded. Import in progress, please wait until the page is updated.';
    }
  });
});
</script>
{% endblock %}

