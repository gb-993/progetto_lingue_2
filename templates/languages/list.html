{% extends "base.html" %}
{% block title %}Languages{% endblock %}
{% block breadcrumb %}Languages{% endblock %}

{% block body_class %}languages-list{% endblock %}

{% block content %}
<header class="dashboard-hero">
  <h1>Languages</h1>
</header>

{% if is_admin %}
  {% include "_toolbar_search.html" with q=q placeholder="Search a language…" add_url="language_add" add_label="Add a new language" %}
{% else %}
  {% include "_toolbar_search.html" with q=q placeholder="Search language…" %}
{% endif %}

<div class="toolbar-actions" style="margin:.5rem 0 1rem; display:flex; gap:.5rem; flex-wrap:wrap;">
  <a class="btn" href="{% url 'language_list_export_xlsx' %}{% if q %}?q={{ q|urlencode }}{% endif %}" rel="nofollow">
    Export .xlsx
  </a>

  {% if is_admin %}
    <a class="btn" href="{% url 'language_export_all_zip' %}">
      Export all languages (.zip)
    </a>
    <a class="btn" href="{% url 'language_import_excel' %}">
      Import from Excel
    </a>
  {% endif %}
</div>


<div class="table-responsive">
  <table class="table">
<thead>
  <tr>
    {#
      Abilitazione delle intestazioni cliccabili:
      - Ogni header usa sort_urls.<campo> per invertire asc/desc.
      - Se la colonna è l’ordinamento corrente, mostra una freccia (↑ ascendente, ↓ discendente).
    #}
    <th scope="col">
      <a href="{{ sort_urls.id }}">Id</a>
      {% if sort == 'id' %}
        {% if dir == 'asc' %}<span aria-hidden="true">↑</span>{% else %}<span aria-hidden="true">↓</span>{% endif %}
      {% endif %}
    </th>
    <th scope="col">
      <a href="{{ sort_urls.name }}">Name</a>
      {% if sort == 'name' %}
        {% if dir == 'asc' %}<span aria-hidden="true">↑</span>{% else %}<span aria-hidden="true">↓</span>{% endif %}
      {% endif %}
    </th>
    <th scope="col">
      <a href="{{ sort_urls.top }}">Top‑level family</a>
      {% if sort == 'top' %}
        {% if dir == 'asc' %}<span aria-hidden="true">↑</span>{% else %}<span aria-hidden="true">↓</span>{% endif %}
      {% endif %}
    </th>
    <!-- le restanti intestazioni non cambiano -->
    <th scope="col">Family</th>
    <th scope="col">Group</th>
    <th scope="col">Last modified</th>
    <th scope="col"></th>
  </tr>
</thead>

    <tbody>
      {% for l in languages %}
        <tr>
          <td data-label="Id">{{ l.id }}</td>
          <td data-label="Name">{{ l.name_full }}</td>
          <td data-label="Top-level">
            {% if l.top_level_family %}{{ l.top_level_family }}{% else %}<span class="muted">—</span>{% endif %}
          </td>
          <td data-label="Family">
            {% if l.family %}{{ l.family }}{% else %}<span class="muted">—</span>{% endif %}
          </td>
          <td data-label="Group">
            {% if l.grp %}{{ l.grp }}{% else %}<span class="muted">—</span>{% endif %}
          </td>
          <td data-label="Last modified">
            {% if l.last_change %}{{ l.last_change|date:"Y-m-d H:i" }}{% else %}<span class="muted">—</span>{% endif %}
          </td>
          <td class="row-actions" data-label="Actions">
            <div class="row-actions-buttons" style="display:flex; flex-wrap:wrap; gap:.5rem;">
              <a class="btn" href="{% url 'language_data' l.id %}">Data</a>
              {% if is_admin %}
                <a class="btn" href="{% url 'language_edit' l.id %}">Edit</a>
                <a class="btn" href="{% url 'language_debug' l.id %}">Debug</a>
              {% endif %}
            </div>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% if page_obj %}
<nav class="pagination" aria-label="Pagination">
  {% if page_obj.has_previous %}
    <a class="btn" href="?q={{ q }}&page={{ page_obj.previous_page_number }}">Previous</a>
  {% endif %}
  <span class="muted">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
  {% if page_obj.has_next %}
    <a class="btn" href="?q={{ q }}&page={{ page_obj.next_page_number }}">Next</a>
  {% endif %}
</nav>
{% endif %}
{% endblock %}
