{% extends "base.html" %}
{% block title %}Languages{% endblock %}
{% block breadcrumb %}
  <li aria-current="page">Languages</li>
{% endblock %}

{% block body_class %}languages-list{% endblock %}

{% block content %}
<header class="dashboard-hero">
  <h1>Languages</h1>
</header>

{% if is_admin %}
  {% include "_toolbar_search.html" with q=q placeholder="Search a language…" add_url="language_add" add_label="Add a new language" %}
{% else %}
  {% include "_toolbar_search.html" with q=q placeholder="Search language…" %}
{% endif %}

<div class="toolbar-actions" style="margin:.5rem 0 1rem; display:flex; gap:.5rem; flex-wrap:wrap;">
  <a class="btn" href="{% url 'language_list_export_xlsx' %}{% if q %}?q={{ q|urlencode }}{% endif %}" rel="nofollow">
    Export .xlsx
  </a>

  {% if is_admin %}
    <a class="btn" href="{% url 'language_export_all_zip' %}">
      Export all languages (.zip)
    </a>
    <a class="btn" href="{% url 'language_import_excel' %}">
      Import from Excel
    </a>

    <a class="btn" href="{% url 'submission_create_all' %}">
      Backup all languages
    </a>
  {% endif %}
</div>


<div class="table-responsive">
  <table class="table">
    <thead>
      <tr>
        <th scope="col">
          <a href="{{ sort_urls.id }}" class="sort-link {% if sort == 'id' %}active{% endif %}">
            Id <span class="sort-indicator">{% if sort == 'id' %}{% if dir == 'asc' %}↑{% else %}↓{% endif %}{% else %}↕{% endif %}</span>
          </a>
        </th>

        <th scope="col">
          <a href="{{ sort_urls.name }}" class="sort-link {% if sort == 'name' %}active{% endif %}">
            Name <span class="sort-indicator">{% if sort == 'name' %}{% if dir == 'asc' %}↑{% else %}↓{% endif %}{% else %}↕{% endif %}</span>
          </a>
        </th>

        <th scope="col">
          <a href="{{ sort_urls.top }}" class="sort-link {% if sort == 'top' %}active{% endif %}">
            Top‑level family <span class="sort-indicator">{% if sort == 'top' %}{% if dir == 'asc' %}↑{% else %}↓{% endif %}{% else %}↕{% endif %}</span>
          </a>
        </th>

        <th scope="col">
          <a href="{{ sort_urls.family }}" class="sort-link {% if sort == 'family' %}active{% endif %}">
            Family <span class="sort-indicator">{% if sort == 'family' %}{% if dir == 'asc' %}↑{% else %}↓{% endif %}{% else %}↕{% endif %}</span>
          </a>
        </th>

        <th scope="col">
          <a href="{{ sort_urls.group }}" class="sort-link {% if sort == 'group' %}active{% endif %}">
            Group <span class="sort-indicator">{% if sort == 'group' %}{% if dir == 'asc' %}↑{% else %}↓{% endif %}{% else %}↕{% endif %}</span>
          </a>
        </th>

        <th scope="col">
          <a href="{{ sort_urls.modified }}" class="sort-link {% if sort == 'modified' %}active{% endif %}">
            Last modified <span class="sort-indicator">{% if sort == 'modified' %}{% if dir == 'asc' %}↑{% else %}↓{% endif %}{% else %}↕{% endif %}</span>
          </a>
        </th>
        <th scope="col"></th>
      </tr>
    </thead>

    <tbody>
      {% for l in languages %}
        <tr>
          <td data-label="Id">{{ l.id }}</td>
          <td data-label="Name">{{ l.name_full }}</td>
          <td data-label="Top-level">
            {% if l.top_level_family %}{{ l.top_level_family }}{% else %}<span class="muted">—</span>{% endif %}
          </td>
          <td data-label="Family">
            {% if l.family %}{{ l.family }}{% else %}<span class="muted">—</span>{% endif %}
          </td>
          <td data-label="Group">
            {% if l.grp %}{{ l.grp }}{% else %}<span class="muted">—</span>{% endif %}
          </td>
          <td data-label="Last modified">
            {% if l.last_change %}{{ l.last_change|date:"Y-m-d H:i" }}{% else %}<span class="muted">—</span>{% endif %}
          </td>
          <td class="row-actions" data-label="Actions">
            <div class="row-actions-buttons" style="display:flex; flex-wrap:wrap; gap:.5rem;">
              <a class="btn" href="{% url 'language_data' l.id %}">Data</a>
              {% if is_admin %}
                <a class="btn" href="{% url 'language_edit' l.id %}">Edit</a>
                <a class="btn" href="{% url 'language_debug' l.id %}">Debug</a>
              {% endif %}
            </div>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% if page_obj %}
<nav class="pagination" aria-label="Pagination">
  {% if page_obj.has_previous %}
    <a class="btn" href="?q={{ q }}&page={{ page_obj.previous_page_number }}">Previous</a>
  {% endif %}
  <span class="muted">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
  {% if page_obj.has_next %}
    <a class="btn" href="?q={{ q }}&page={{ page_obj.next_page_number }}">Next</a>
  {% endif %}
</nav>
{% endif %}

    <style>

  .dashboard-hero {
    margin-bottom: 5rem;  /* . 4rem o 5rem per più spazio tra TITOLO E BODY */
  }


  .sort-link {
    text-decoration: none;
    color: inherit;
    display: inline-flex;
    align-items: center;
    gap: 5px;
  }
  .sort-link:hover {
    color: #ff4500; /* Il colore arancione del tuo brand */
  }
  .sort-indicator {
    font-size: 0.8rem;
    opacity: 0.5;
  }
  .sort-link.active .sort-indicator {
    opacity: 1;
    color: #ff4500;
    font-weight: bold;
  }
</style>
<style>
  /* ... mantieni il CSS esistente (.dashboard-hero, .sort-link, etc) ... */

  /* --- MODIFICHE LAYOUT MOBILE PER LINGUE (< 900px) --- */
  @media (max-width: 900px) {

    /* 1. Trasformiamo la riga in una Card Grid */
    .table tbody tr {
      display: grid;
      grid-template-columns: 1fr auto; /* Colonna sx elastica, dx fissa per la data */
      gap: 0.5rem;
      padding: 1rem;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      margin-bottom: 1rem;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
      position: relative;
    }

    /* 2. Reset delle celle (TD) */
    .table tbody td {
      display: block;
      padding: 0;
      border: none;
      grid-column: 1 / -1; /* Di base occupano tutta la larghezza */
      width: auto !important; /* Forza larghezza auto */
    }

    /* 3. Nascondiamo le label automatiche per i campi principali */
    .table tbody td[data-label="Id"]::before,
    .table tbody td[data-label="Name"]::before,
    .table tbody td[data-label="Last modified"]::before,
    .table tbody td[data-label="Actions"]::before {
      display: none;
    }

    /* --- LAYOUT INTERNO DELLA CARD --- */

    /* A. HEADER: ID (Badge) e Data (Piccola a dx) */
    .table tbody td[data-label="Id"] {
      grid-column: 1;
      grid-row: 1;
      width: fit-content;
      background: var(--surface-2);
      color: var(--text-muted);
      font-family: var(--mono);
      font-weight: 700;
      font-size: 0.8rem;
      padding: 2px 8px;
      border-radius: 6px;
      margin-bottom: 0.25rem;
    }

    .table tbody td[data-label="Last modified"] {
      grid-column: 2;
      grid-row: 1;
      text-align: right;
      font-size: 0.75rem;
      color: var(--text-muted);
      white-space: nowrap;
      align-self: center;
    }

    /* B. TITOLO: Nome della lingua (Grande) */
    .table tbody td[data-label="Name"] {
      grid-column: 1 / -1;
      grid-row: 2;
      font-size: 1.3rem;
      font-weight: 800;
      color: var(--brand);
      margin-bottom: 0.75rem;
      line-height: 1.2;
    }

    /* C. METADATI: Gerarchia (Top-level, Family, Group) */
    /* Li mettiamo in una lista pulita con etichette allineate */
    .table tbody td[data-label="Top-level"],
    .table tbody td[data-label="Family"],
    .table tbody td[data-label="Group"] {
      display: flex;
      align-items: baseline;
      font-size: 0.9rem;
      margin-bottom: 4px;
      color: var(--text);
      padding-left: 0.2rem;
    }

    /* Stile delle etichette (Top-level:, Family:, etc.) */
    .table tbody td[data-label="Top-level"]::before,
    .table tbody td[data-label="Family"]::before,
    .table tbody td[data-label="Group"]::before {
      content: attr(data-label);
      display: inline-block;
      width: 80px; /* Larghezza fissa per allineare i valori */
      flex-shrink: 0;
      font-size: 0.75rem;
      text-transform: uppercase;
      font-weight: 600;
      color: var(--text-muted);
      opacity: 0.8;
    }

    /* D. AZIONI: Bottoni in basso */
    .table tbody td[data-label="Actions"] {
      grid-column: 1 / -1;
      margin-top: 1rem;
      padding-top: 0.75rem;
      border-top: 1px dashed var(--border);
    }

    /* I bottoni occupano lo spazio disponibile */
    .table tbody td[data-label="Actions"] .row-actions-buttons {
      display: flex;
      gap: 0.5rem;
    }

    .table tbody td[data-label="Actions"] .btn {
      flex: 1; /* Bottoni "stretchati" per facile tocco */
      justify-content: center;
      padding: 0.6rem;
    }
  }
</style>

{% endblock %}

