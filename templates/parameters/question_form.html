{% extends "base.html" %}
{% load static %}
{% block title %}{% if is_create %}Add question{% else %}Edit question{% endif %}{% endblock %}
{% block breadcrumb %}Parameters / {{ parameter.id }} / {% if is_create %}Add question{% else %}Edit {{ form.initial.id|default_if_none:"" }}{% endif %}{% endblock %}

{% block content %}
<div class="card">
  <h2>{% if is_create %}Add question{% else %}Edit question{% endif %} — {{ parameter.id }}</h2>

  <form method="post" novalidate>
    {% csrf_token %}

    {% if form.non_field_errors %}
      <div class="alert alert--error" role="alert">{{ form.non_field_errors }}</div>
    {% endif %}

    <div class="grid grid-2">
      <div class="form-row">
        <label>Id</label>
        <input class="form-control" value="{{ form.instance.id }}" readonly>
        {{ form.id.as_hidden }}
      </div>

      <div class="form-row">
        {{ form.template_type.label_tag }} {{ form.template_type }}
        {% if form.template_type.errors %}<div class="field-error">{{ form.template_type.errors }}</div>{% endif %}
      </div>

      <div class="form-row" style="grid-column: 1 / -1;">
        {{ form.text.label_tag }} {{ form.text }}
        {% if form.text.errors %}<div class="field-error">{{ form.text.errors }}</div>{% endif %}
      </div>

      <div class="form-row" style="grid-column: 1 / -1;">
        {{ form.example_yes.label_tag }} {{ form.example_yes }}
        {% if form.example_yes.errors %}<div class="field-error">{{ form.example_yes.errors }}</div>{% endif %}
      </div>

      <div class="form-row" style="grid-column: 1 / -1;">
        {{ form.help_info.label_tag }} {{ form.help_info }}
        <div class="muted">Short extra context shown to users via a little “More info” popover.</div>
        {% if form.help_info.errors %}<div class="field-error">{{ form.help_info.errors }}</div>{% endif %}
      </div>

      <div class="form-row" style="grid-column: 1 / -1;">
        {{ form.instruction.label_tag }} {{ form.instruction }}
        {% if form.instruction.errors %}<div class="field-error">{{ form.instruction.errors }}</div>{% endif %}
      </div>

      <div class="form-row" style="grid-column: 1 / -1;">
        {{ form.instruction_yes.label_tag }} {{ form.instruction_yes }}
        <div class="muted">Shown to the user only if the answer is YES.</div>
        {% if form.instruction_yes.errors %}<div class="field-error">{{ form.instruction_yes.errors }}</div>{% endif %}
      </div>

      <div class="form-row" style="grid-column: 1 / -1;">
        {{ form.instruction_no.label_tag }} {{ form.instruction_no }}
        <div class="muted">Shown to the user only if the answer is NO.</div>
        {% if form.instruction_no.errors %}<div class="field-error">{{ form.instruction_no.errors }}</div>{% endif %}
      </div>

      {% if form.is_stop_question and not form.is_stop_question.is_hidden %}
      <div class="form-row">
        <label class="form-check">
          {{ form.is_stop_question }} Stop question
        </label>
        {% if form.is_stop_question.errors %}<div class="field-error">{{ form.is_stop_question.errors }}</div>{% endif %}
      </div>
      {% endif %}

      <div class="form-row" style="grid-column: 1 / -1;">
        <label>Motivations linked to this question</label>

        {{ form.motivations }}
        {% if form.motivations.errors %}
          <div class="field-error">{{ form.motivations.errors }}</div>
        {% endif %}

        <div class="muted" style="margin-top:.5rem;">
          Select which motivations will be available to users when they answer "NO" to this question.
        </div>

        <div class="actions" style="margin-top:.75rem; text-align: right;">
          <a class="btn" href="{% url 'motivations_manage' %}" target="_blank" rel="noopener"
             aria-label="Open motivation manager in a new tab">
            Edit motivations
          </a>
        </div>
      </div>

    </div>

    <div class="toolbar" style="display: flex; justify-content: flex-end; gap: 10px;">
      <button class="btn btn--primary" type="submit">{% if is_create %}Add{% else %}Save{% endif %}</button>
      <a class="btn" href="{% url 'parameter_edit' parameter.id %}">Cancel</a>
    </div>
  </form>
</div>
{% endblock %}
