{% extends "base.html" %}
{% block title %}Parameters Debug — {{ language.id }}{% endblock %}
{% block breadcrumb %}Languages / {{ language.id }} / Parameters Debug{% endblock %}

{% block content %}
  <h1 class="main-title">
    Parameters Debug — {{ language.name_full|default:language.id }} ({{ language.id }})
  </h1>

  <div class="toolbar" style="display:flex;gap:.5rem;flex-wrap:wrap">
    <a class="btn" href="{% url 'language_data' language.id %}">Back to language data</a>

    {# Run DAG (Apply implications) #}
    <form method="post" action="{% url 'language_run_dag' language.id %}" class="d-inline" aria-label="Apply implications">
      {% csrf_token %}
      <button type="submit" class="btn btn--primary" aria-live="polite">
        Apply implications
      </button>
    </form>
  </div>

  <div class="card" style="overflow:auto">
    <table class="table">
      <thead>
        <tr>
          <th class="w-1ch">#</th>
          <th class="w-5ch">Label</th>
          <th>Questions</th>
          <th>Answers</th>
          <th class="w-10ch nowrap">Initial value</th>
          <th class="w-8ch">Warn (init)</th>
          <th>Implicational condition(s)</th>
          {# NUOVA COLONNA: esito della condizione #}
          <th class="w-10ch">Check</th>
          <th class="w-10ch">Final value</th>
          <th class="w-8ch">Warn (final)</th>
        </tr>
      </thead>
      <tbody>
        {% for r in rows %}
          <tr>
            <td>{{ r.position }}</td>
            <td><strong>{{ r.param_id }}</strong></td>

            <td>
              {% if r.questions %}
                {% for qid in r.questions %}
                  <div><code>{{ qid }}</code></div>
                {% endfor %}
              {% else %}
                <span class="muted">—</span>
              {% endif %}
            </td>

            <td>
              {% if r.answers %}
                {% for a in r.answers %}
                  <div>{{ a }}</div>
                {% endfor %}
              {% else %}
                <span class="muted">—</span>
              {% endif %}
            </td>

            <td class="num nowrap">
              {% if r.initial == '+' %}+{% elif r.initial == '-' %}-{% else %}<span class="muted"> </span>{% endif %}
            </td>

            <td data-label="Warn (init)">
              {% if r.warn_init %}
                <span class="badge b-bad" aria-label="Initial warning true">⚠</span>
              {% else %}
                <span class="muted"></span>
              {% endif %}
            </td>

            <td>
              {% if r.cond %}
                <div><code>{{ r.cond }}</code></div>
              {% else %}
                <span class="muted">—</span>
              {% endif %}
            </td>

            {# CELLA NUOVA: TRUE / FALSE / — #}
            <td>
              {% if r.cond_true is True %}
                <span class="badge b-good">TRUE</span>
              {% elif r.cond_true is False %}
                <span class="badge b-bad">FALSE</span>
              {% else %}
                <span class="muted">—</span>
              {% endif %}
            </td>

            <td class="num nowrap">
              {% if r.final == '+' %}+{% elif r.final == '-' %}-{% elif r.final == '0' %}0{% else %}<span class="muted"> </span>{% endif %}
            </td>

            <td data-label="Warn (final)">
              {% if r.warn_final %}
                <span class="badge b-bad" aria-label="Final warning true">⚠</span>
              {% else %}
                <span class="muted"></span>
              {% endif %}
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% endblock %}
