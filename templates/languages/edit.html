{% extends "base.html" %}
{% block title %}Edit language{% endblock %}
{% block breadcrumb %}Languages / {{ language.id }} / Edit{% endblock %}

{% block content %}
  <div class="card">
    <h2 class="h3">Edit: {{ language.name_full }} ({{ language.id }})</h2>

    <form method="post" novalidate>
      {% csrf_token %}
      {{ form.non_field_errors }}

      <div class="grid grid-2">

        {% for field in form %}
          {% if field.name != "assigned_user" %}
            <div class="form-row">
              <label for="{{ field.id_for_label }}">{{ field.label }}</label>
              {{ field }}
              {% if field.errors %}<div class="error">{{ field.errors|striptags }}</div>{% endif %}
              {% if field.help_text %}<div class="muted">{{ field.help_text }}</div>{% endif %}
            </div>
          {% endif %}
        {% endfor %}

        {# --- Campo di sola lettura per l'assegnatario --- #}
        <div class="form-row">
          <label>Assigned to</label>
          <div class="form-control is-plaintext" aria-readonly="true">
            {% if language.assigned_user %}
              {{ language.assigned_user.name }} {{ language.assigned_user.surname }} ({{ language.assigned_user.email }})
            {% else %}
              <span class="muted">â€”</span>
            {% endif %}
          </div>
          <div class="muted">
            <a href="{% url 'accounts_list' %}" class="link-muted">
              Editable from the account page
            </a>
          </div>
        </div>

      </div>

      <div class="toolbar">
        <button class="btn btn--primary">Save</button>
        <a class="btn" href="{% url 'language_list' %}">Cancel</a>
      </div>
    </form>
    
    {% if request.user.is_staff or request.user.is_superuser or request.user.role == 'admin' %}
      <hr>
      <form method="post"
            action="{% url 'language_delete' language.id %}"
            onsubmit="return confirm('WARNING: All data linked to this language (answers, examples, submissions, logs, etc.) will be PERMANENTLY deleted. Do you want to continue?')"
            style="display:block; margin-top:1.5rem; padding-top:1rem; clear:both; max-width:20rem;">
        {% csrf_token %}
        <label for="admin_password" class="muted" style="display:block; margin-bottom:.25rem;">
          Confirm with password:
        </label>
        <input type="password"
              id="admin_password"
              name="admin_password"
              class="form-control"
              required
              style="width:100%; margin-bottom:.75rem;">
        <button type="submit" class="btn btn--danger">
          Delete language
        </button>
      </form>
    {% endif %}


  </div>
{% endblock %}
