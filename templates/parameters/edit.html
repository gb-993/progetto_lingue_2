{% extends "base.html" %}
{% block title %}{% if param %}Edit parameter {{ param.id }}{% else %}Add parameter{% endif %}{% endblock %}

{% block content %}
<form method="post" class="parameter-form" novalidate aria-describedby="form-help">
  {% csrf_token %}

  {# Errori globali #}
  {% if form.non_field_errors %}
    <div class="alert alert-danger" role="alert" aria-live="assertive">
      {{ form.non_field_errors }}
    </div>
  {% endif %}

  {% if param %}
    <div class="grid grid-2">
      <div>
        {{ form.id.label_tag }}
        <input class="form-control"
               value="{{ form.id.value|default_if_none:'' }}"
               readonly
               aria-describedby="id-help">
        {{ form.id.as_hidden }}
        <p id="id-help" class="muted">Label non modificabile.</p>
      </div>
    </div>
  {% else %}
    <div class="grid grid-2">
      <div class="{% if form.id.errors %}field-error{% endif %}">
        {{ form.id.label_tag }}
        {{ form.id }}
        {% if form.id.errors %}<div class="error" role="alert">{{ form.id.errors }}</div>{% endif %}
      </div>
    </div>
  {% endif %}

  <div class="grid grid-2">
    <div class="{% if form.name.errors %}field-error{% endif %}">
      {{ form.name.label_tag }}
      {{ form.name }}
      {% if form.name.errors %}<div class="error" role="alert">{{ form.name.errors }}</div>{% endif %}
    </div>

    <div class="{% if form.position.errors %}field-error{% endif %}">
      {{ form.position.label_tag }}
      {{ form.position }}
      {% if form.position.errors %}
        <div class="error" role="alert">{{ form.position.errors }}</div>
      {% else %}
        <p class="muted" id="pos-help">
          Ordine di visualizzazione (intero ≥ 1). Se la posizione è occupata, lo shift è automatico.
        </p>
      {% endif %}
    </div>
  </div>

  <div class="{% if form.short_description.errors %}field-error{% endif %}">
    {{ form.short_description.label_tag }}
    {{ form.short_description }}
    {% if form.short_description.errors %}<div class="error" role="alert">{{ form.short_description.errors }}</div>{% endif %}
  </div>

  <div class="{% if form.implicational_condition.errors %}field-error{% endif %}">
    {{ form.implicational_condition.label_tag }}
    {{ form.implicational_condition }}
    {% if form.implicational_condition.errors %}<div class="error" role="alert">{{ form.implicational_condition.errors }}</div>{% endif %}
  </div>

  <div class="{% if form.is_active.errors %}field-error{% endif %}">
    <label class="form-check">
      {{ form.is_active }} <span>{{ form.is_active.label }}</span>
    </label>
    {% if form.is_active.errors %}<div class="error" role="alert">{{ form.is_active.errors }}</div>{% endif %}
  </div>

  <div class="toolbar">
    <a class="btn" href="{% url 'parameter_list' %}">Cancel</a>
    <button class="btn btn--primary" type="submit">Save</button>
  </div>

  <p id="form-help" class="sr-only">
    Compila i campi obbligatori. Gli errori sono mostrati sotto i campi.
  </p>
</form>

{# Box debug temporaneo: lascia finché stai verificando #}
{% if form.errors %}
  <pre style="margin-top:16px;padding:12px;border:1px dashed;">
{{ form.errors }}
  </pre>
{% endif %}
{% endblock %}
