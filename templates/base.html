<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <script>
    (function () {
      try {
        var stored = localStorage.getItem('theme'); 
        var theme = stored || (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
        document.documentElement.setAttribute('data-theme', theme);
        document.documentElement.style.colorScheme = theme;
      } catch (e) {
        document.documentElement.setAttribute('data-theme', 'light');
        document.documentElement.style.colorScheme = 'light';
      }
    })();
  </script>
  <meta name="color-scheme" content="light dark">

  <title>{% block title %}Parametric Comparison Method (PCM){% endblock %}</title>
  {% load static %}
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
  <link rel="stylesheet" href="{% static 'css/mobile.css' %}" media="(max-width: 768px)">
  {% block extra_head %}{% endblock %}
</head>

<body class="{% block body_class %}{% endblock %}">

  <!-- HEADER -->
  <header class="site-header">
    <div class="container">
      <h1 class="site-title">
        PCM Hub
        <span class="site-subtitle"> Parametric Comparison Method (PCM) – Data collection and storage</span>
      </h1>

      {% with urln=request.resolver_match.url_name|default:'' %}
<nav class="nav" aria-label="Main">
  <ul class="nav-list">

    {# Dashboard #}
    <li>
      <a class="btn {% if urln == 'dashboard' %}is-current{% endif %}"
         href="{% url 'dashboard' %}"
         {% if urln == 'dashboard' %}aria-current="page"{% endif %}>
         Dashboard
      </a>
    </li>

      {# Languages #}
    <li>
      <a class="btn {% if urln == 'language_list' or urln == 'language_add' or urln == 'language_edit' or urln == 'language_data' %}is-current{% endif %}"
         href="{% url 'language_list' %}"
         {% if urln == 'language_list' or urln == 'language_add' or urln == 'language_edit' or urln == 'language_data' %}aria-current="page"{% endif %}>
         Languages
      </a>
    </li>

      {% if request.user.is_staff or request.user.is_superuser or request.user.role == 'admin' %}

        {# Parameters #}
      <li>
        <a class="btn {% if urln == 'parameter_list' or urln == 'parameter_edit' or urln == 'parameter_add' %}is-current{% endif %}"
           href="{% url 'parameter_list' %}"
           {% if urln == 'parameter_list' or urln == 'parameter_edit' or urln == 'parameter_add' %}aria-current="page"{% endif %}>
           Parameters
        </a>
      </li>

        {# Parameter Network #}
      <li>
        <a class="btn {% if urln == 'parameters_graph' %}is-current{% endif %}"
           href="{% url 'parameters_graph' %}"
           {% if urln == 'parameters_graph' %}aria-current="page"{% endif %}>
           Parameter Network
        </a>
      </li>

        {# Table A #}
      <li>
        <a class="btn {% if urln == 'tablea_index' %}is-current{% endif %}"
           href="{% url 'tablea_index' %}"
           {% if urln == 'tablea_index' %}aria-current="page"{% endif %}>
           Table A
        </a>
      </li>

        {# Queries #}
      <li>
        <a class="btn {% if urln|slice:':7' == 'queries' %}is-current{% endif %}"
           href="{% url 'queries:home' %}"
           {% if urln|slice:':7' == 'queries' %}aria-current="page"{% endif %}>
           Filters
        </a>
      </li>

        {# Submissions #}
      <li>
        <a class="btn {% if urln == 'submissions_list' or urln == 'submission_detail' %}is-current{% endif %}"
           href="{% url 'submissions_list' %}"
           {% if urln == 'submissions_list' or urln == 'submission_detail' %}aria-current="page"{% endif %}>
           Saved languages
        </a>
      </li>

        {# Accounts #}
      <li>
        <a class="btn {% if urln == 'accounts_list' or urln == 'account_edit' or urln == 'account_add' %}is-current{% endif %}"
           href="{% url 'accounts_list' %}"
           {% if urln == 'accounts_list' or urln == 'account_edit' or urln == 'account_add' %}aria-current="page"{% endif %}>
            Accounts
        </a>
      </li>
    {% endif %}


    {# Instructions #}
    <li>
      <a class="btn {% if urln == 'instruction' %}is-current{% endif %}"
         href="{% url 'instruction' %}"
         {% if urln == 'instruction' %}aria-current="page"{% endif %}>
         Instructions
      </a>
    </li>

    {# Glossary #}
    <li>
      <a class="btn {% if urln == 'glossary_list' or urln == 'glossary_edit' or urln == 'glossary_add' %}is-current{% endif %}"
         href="{% url 'glossary_list' %}"
         {% if urln == 'glossary_list' or urln == 'glossary_edit' or urln == 'glossary_add' %}aria-current="page"{% endif %}>
         Glossary
      </a>
    </li>




    <li class="nav-spacer" aria-hidden="true"></li>

        {# My Account #}
      <li>
      <a class="btn {% if urln == 'my_account' %}is-current{% endif %}"
         href="{% url 'my_account' %}"
         {% if urln == 'my_account' %}aria-current="page"{% endif %}>
         My Account
      </a>
    </li>

    {# Logout and theme toggle #}
    <li class="nav-session">
      <form action="{% url 'logout' %}" method="post" aria-label="Logout" style="display:inline">{% csrf_token %}
        <button class="btn" type="submit">Logout</button>
      </form>
      <button id="theme-toggle" type="button" class="btn theme-toggle"></button>
    </li>
  </ul>
</nav>
      {% endwith %}

      <nav class="breadcrumb" aria-label="Breadcrumb">
        {% block breadcrumb %}<span>Dashboard</span>{% endblock %}
      </nav>
    </div>
  </header>

  <a href="#main" class="sr-only">Skip to main content</a>

  <!-- FLASH MESSAGES -->
  <section role="status" aria-live="polite" aria-atomic="true">
    {% include "_partials/messages.html" %}
  </section>

  <!-- MAIN -->
  <main id="main" role="main" tabindex="-1">
    <div class="container">
      {% block content %}{% endblock %}
    </div>
  </main>

  <!-- FOOTER -->
  {% block footer %}
  <footer class="site-footer" role="contentinfo">
    <div class="container">
      {% if request.user.is_staff or request.user.is_superuser or request.user.role == 'admin' %}
        <p class="muted">© {% now "Y" %} – Admin area</p>
      {% else %}
        <p class="muted">© {% now "Y" %} – User area</p>
      {% endif %}
    </div>
  </footer>
  {% endblock %}

  {% block extra_js %}{% endblock %}
  <script>
    (function () {
      var root = document.documentElement;
      var btn = document.getElementById('theme-toggle');
      if (!btn) return;

      function currentTheme() {
        return root.getAttribute('data-theme') === 'dark' ? 'dark' : 'light';
      }
      function setTheme(next) {
        root.setAttribute('data-theme', next);
        root.style.colorScheme = next;
        try { localStorage.setItem('theme', next); } catch (e) {}
        updateButton(next);
      }
      function updateButton(theme) {
        var icon = theme === 'dark'
          ? 'Light'  
          : 'Dark'; 
        btn.textContent = icon;
        btn.setAttribute('aria-pressed', theme === 'dark' ? 'true' : 'false');
        btn.setAttribute('aria-label', 'Toggle theme');
        btn.title = theme === 'dark' ? 'Light theme' : 'Dark theme';
      }
      updateButton(currentTheme());
      btn.addEventListener('click', function () {
        var next = currentTheme() === 'dark' ? 'light' : 'dark';
        setTheme(next);
      });
      try {
        if (!localStorage.getItem('theme') && window.matchMedia) {
          var mq = window.matchMedia('(prefers-color-scheme: dark)');
          mq.addEventListener('change', function (e) {
            setTheme(e.matches ? 'dark' : 'light');
          });
        }
      } catch (e) {}
    })();
  </script>

  <button id="backToTop" class="back-to-top is-hidden" type="button" aria-label="Torna su" title="Back to top">↑</button>
  <script src="{% static 'js/back_to_top.js' %}"></script>
  <script src="{% static 'js/messages.js' %}" defer></script>
  <script src="{% static 'js/dashboard.js' %}"></script>

</body>
</html>
